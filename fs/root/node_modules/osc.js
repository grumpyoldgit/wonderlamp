var osc = require('osc-min');
var dgram = require('dgram');

// Client object

var Client = function (host, port) {
	console.log("Opening UDP datagram client to host " + host + " on port " + port);
	this.host = host;
	this.port = port;
	this.sock = dgram.createSocket('udp4');
};

Client.prototype.kill = function () {
	this.sock.close();
};

Client.prototype.send = function(data) {
	this.sock.send(data, 0, data.length, this.port, this.host);
};

// Fader object

var Fader = function (host, port, channel) {
	this.channel = channel;
	this.client = new Client(host, port);
}

var Toggle = function (host, port, channel) {
	this.channel = channel;
	this.client = new Client(host, port);
}

Fader.prototype.send = function(distanceInInches) {

	/* 
	OSC lightjams values must be floats - 0.0 to 1.0
	*/

	var DIST_MAX = 256.0;

	var floatValue = 1 - distanceInInches / DIST_MAX;

	console.log("floatValue : " + floatValue );

	this.client.send(osc.toBuffer({address:'/lj/osc/' + this.channel.toString(), args: [
		// float osc message
		{type : "float", value : floatValue }
	]}));
}

Toggle.prototype.send = function(buttonPushed) {

	/* 
	OSC lightjam toggle - for button pressing goodness
	*/

	console.log("buttonPushed : " + buttonPushed.toString() );

	var floatValue = 0;

	if (buttonPushed) {
		floatValue = 1;
	}

	this.client.send(osc.toBuffer({address:'/lj/osc/' + this.channel.toString(), args: [
		// float osc message
		{type : "float", value : floatValue }
	]}));
}

module.exports = {
	createFader: function(host, port, channel) {
		return new Fader(host, port, channel);
	},
	createToggle: function(host, port, channel) {
		return new Toggle(host, port, channel);
	}
}
