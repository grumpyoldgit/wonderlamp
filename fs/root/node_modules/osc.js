var osc = require('osc-min');
var dgram = require('dgram');

var Client = function (host, port) {
    this.host = host;
    this.port = port;
    this._sock = dgram.createSocket('udp4');
    this.kill = function() {
        this._sock.close();
    };
    this.send = function(data) {
    	this._sock.send(data, 0, data.length, port, host);
    }
};

var my_client;

var value = 0;

module.exports = {
	connect: function(host, port) {
		console.log("Opening UDP datagram client to host " + host + " on port " + port);
		my_client = new Client(host, port);
	},
	transmitFaderData: function (faderNumber, floatValue) {
		value = value + 1;
		my_client.send(osc.toBuffer({address:'/midi', args: [
            {type : "midi", value : { channel : 0, status: (value % 255), data1: 3, data2: 0xb0 } }
        ]}));
	}
}